files:
  - {"name": "submission.py", "source": "@SUBMISSION@"}
  - {"name": "task.py", "source": "task.py"}
  - {"name": "utils.py", "source": "../utils.py"}
  - {"name": "reference.py", "source": "reference.py"}
  - {"name": "eval.py", "source": "../eval.py"}

lang: "py"

description: |
  
  You will implement a batched matrix-matrix multiplication kernel optimized for NVIDIA B200.
  To be explicit, you will be given a tuple of tensors:
  ```
  (a, b, sfa, sfb, sfa_permuted, sfb_permuted, c)
  ```
  where:
  * `a` is M x K x L in K-major order in nvfp4(e2m1)
  * `b` is N x K x L in K-major order in nvfp4(e2m1)
  * `sfa` is M x (K // 16) x L in K-major order in fp8(e4m3fnuz)
  * `sfb` is N x (K // 16) x L in K-major order in fp8(e4m3fnuz)
  * `sfa_permuted` is 32 x 4 x rest_m x 4 x rest_k x L in fp8(e4m3fnuz)
  * `sfb_permuted` is 32 x 4 x rest_n x 4 x rest_k x L in fp8(e4m3fnuz)
  * `c` is M x N x L in fp16
  
  Matrix sizes `M` and `N` are divisible by mma_tiler_mn[0] defined in the kernel, `K` is divisible by 64.
  The ranking criteria is the geometric mean of the benchmark results.
  For the grand price, your kernel will be evaluated against the speed of light analysis
  and the solution closest to the speed of light will be awarded the grand price.

config:
  main: "eval.py"

templates:
  Python: "template.py"

tests:
  - {"m": 128, "n": 256, "k": 256, "l": 1, "seed": 1111}
  - {"m": 128, "n": 1536, "k": 7168, "l": 1, "seed": 1111}
  - {"m": 128, "n": 3072, "k": 1536, "l": 1, "seed": 1111}
  - {"m": 256, "n": 7168, "k": 256, "l": 1, "seed": 1111}
  - {"m": 256, "n": 7168, "k": 2048, "l": 1, "seed": 1111}
  - {"m": 2304, "n": 4608, "k": 7168, "l": 1, "seed": 1111}
  - {"m": 384, "n": 7168, "k": 2304, "l": 1, "seed": 1111}
  - {"m": 512, "n": 512, "k": 7168, "l": 1, "seed": 1111}
  - {"m": 512, "n": 4096, "k": 512, "l": 1, "seed": 1111}
  - {"m": 512, "n": 1536, "k": 7168, "l": 1, "seed": 1111}

benchmarks:
  - {"m": 7168, "n": 128, "k": 16384, "l": 1, "seed": 1111}
  - {"m": 4096, "n": 128, "k": 7168, "l": 1, "seed": 1111}
  - {"m": 7168, "n": 128, "k": 2048, "l": 1, "seed": 1111}

ranking_by: "geom"

